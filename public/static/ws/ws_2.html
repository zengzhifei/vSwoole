<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://page.ctvit.tv/jssdk/jquery-1.8.0.min.js"></script>
    <script src="http://page.ctvit.tv/jssdk/interact-1.2.2.min.js"></script>
    <script src="http://page.ctvit.tv/jssdk/interact.ws.js"></script>
</head>
<body>
<div><input type="text" name="user-id" placeholder="用户ID"></div>
<div><input type="text" name="message" placeholder="消息"></div>
<button>发送</button>
<script>
    $(function () {
        //interact.initConsole();
        var ws;
        window.link_count = 0;
        window.message_count = 0;
        for (var i = 2; i <= 2; i++) {
            create_ws(i);
        }

        function create_ws(i) {
            ws = new WS('ws://192.168.31.101/ws', {
                'is_heart_check' : false,
                'auto_connect': false,
                onOpen: function (ws) {
                    var range_data = {cmd: 'range', data: {user_id: i ? i : 1, range_id: 123456}};
                    ws.send(JSON.stringify(range_data));
                    window.link_count++;
                    var online_data = {cmd: 'online', data: {range_id: 123456}};
                   /* setInterval(function() {
                        ws.send(JSON.stringify(online_data));
                    },2000);*/

                },
                onMessage: function (ws, data) {
                     var data = JSON.parse(data);
                    console.log(interact.getTime());
                    console.log(data);
                    window.message_count++;
                }
            })
        }

        $("button").click(function () {
            var range_id = 123456;
            var user_id = $("[name='user-id']").val();
            var message = $("[name='message']").val();
            var data = {cmd: 'send', data: {range_id: range_id, user_id: user_id ? user_id :null, message: message}};
            if (ws.readyState == 1) {
                ws.send(JSON.stringify(data));
            }
        })
    })
</script>

</body>
</html>