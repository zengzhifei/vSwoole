<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://page.ctvit.tv/jssdk/jquery-1.8.0.min.js"></script>
    <script src="http://page.ctvit.tv/jssdk/interact-1.2.2.min.js"></script>
    <script src="http://page.ctvit.tv/jssdk/interact.ws.js"></script>
</head>
<body>
<div><input type="text" name="user-id" placeholder="用户ID"></div>
<div><input type="text" name="message" placeholder="消息"></div>
<button>发送</button>
<script>
    $(function () {
        //interact.initConsole();
        window.link_count = 0;
        window.message_count = 0;
        for (var i = 401; i <= 600; i++) {
            create_ws(i);
        }
        function create_ws(i){
            new WS('ws://10.4.0.101:9501', {
                'auto_connect' : false,
                onOpen: function (ws) {
                    var range_data = {cmd: 'range', data: {user_id: i, range_id: 123456}};
                    ws.send(JSON.stringify(range_data));
                    window.link_count++;
                },
                onMessage: function (ws, data) {
                    var data = JSON.parse(data);
                    console.log(interact.getTime());
                    window.message_count++;
                }
            })
        }

        $("button").click(function () {
            var range_id = 123456;
            var user_id = $("[name='user-id']").val();
            var message = $("[name='message']").val();
            var data = {cmd: 'send', range_id: range_id, message: message};
            if (user_id) {
                data['user_id'] = user_id;
            }
            if (ws.readyState == 1) {
                console.log(data);
                ws.send(JSON.stringify(data));
            }
        })
    })
</script>

</body>
</html>